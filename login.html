<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rising Progress â€“ Login</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />

<style>
    body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #ffffff;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .card {
        width: 360px;
        background: white;
        border-radius: 14px;
        padding: 32px;
        box-shadow: 0px 12px 32px rgba(0,0,0,0.10);
        animation: fadeIn 0.5s ease;
        border-top: 8px solid #2563eb;
        position: relative;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    h2 {
        margin: 0 0 24px;
        font-weight: 600;
        text-align: center;
        color: #1f2937;
    }

    input {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        font-size: 15px;
    }

    .btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: none;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-login {
        background: #2563eb;
        color: white;
    }
    .btn-login:hover { background: #1e4fc2; }

    .btn-signup {
        background: #ea580c;
        color: white;
        margin-top: 8px;
    }
    .btn-signup:hover { background: #c94a0a; }

    .google-btn {
        margin-top: 16px;
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .google-btn img { width: 18px; }

    .forgot {
        text-align: right;
        margin-top: -10px;
        margin-bottom: 16px;
    }
    .forgot a {
        color: #2563eb;
        text-decoration: none;
        font-size: 14px;
    }

    .terms {
        margin-top: 18px;
        text-align: center;
        font-size: 13px;
        color: #374151;
    }
    .terms a {
        color: #2563eb;
        text-decoration: none;
        font-weight: 600;
    }

    /* Error banner + shake */
    .error-banner {
        display: none;
        background: #b91c1c;
        color: #fee2e2;
        padding: 10px 12px;
        border-radius: 8px;
        margin-bottom: 14px;
        font-size: 14px;
        border: 1px solid #fecaca;
        text-align: center;
    }
    .error-banner.show {
        display: block;
    }

    .shake {
        animation: shake 0.22s ease-in-out;
    }
    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(4px); }
        75% { transform: translateX(-4px); }
        100% { transform: translateX(0); }
    }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendPasswordResetEmail,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

function getRedirectTarget() {
    const params = new URLSearchParams(window.location.search);
    return params.get("redirect") || "progress.html";
}

const firebaseConfig = {
    apiKey: "AIzaSyDai5gpX1x9I3uaF4MI7WAzq2oItLRPoZA",
    authDomain: "rising-progress.firebaseapp.com",
    projectId: "rising-progress"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const banner = document.getElementById("errorBanner");
const card = document.querySelector(".card");

function showError(msg) {
    banner.textContent = msg;
    banner.classList.add("show");
    card.classList.remove("shake");
    void card.offsetWidth;
    card.classList.add("shake");
}

function clearError() {
    banner.classList.remove("show");
}

async function completeLogin() {
    try {
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type: "LOGIN_SUCCESS" }, "*");
        } else {
            window.location.href = getRedirectTarget();
        }
    } catch (e) {
        console.warn("Login success message failed", e);
    }
}

window.login = function () {
    clearError();
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    signInWithEmailAndPassword(auth, email, password)
        .then(completeLogin)
        .catch(err => showError(err.message));
};

window.signup = function () {
    clearError();
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    createUserWithEmailAndPassword(auth, email, password)
        .then(completeLogin)
        .catch(err => showError(err.message));
};

window.googleLogin = function () {
    clearError();
    signInWithPopup(auth, provider)
        .then(completeLogin)
        .catch(err => showError(err.message));
};

window.resetPassword = function () {
    clearError();
    const email = document.getElementById("email").value;
    if (!email) return showError("Enter your email first.");

    sendPasswordResetEmail(auth, email)
        .then(() => showError("Password reset email sent."))
        .catch(err => showError(err.message));
};

onAuthStateChanged(auth, (user) => {
    if (user) completeLogin();
});
</script>
</head>

<body>
    <div class="card">
        <div id="errorBanner" class="error-banner"></div>

        <h2>Rising Progress</h2>

        <input id="email" type="email" placeholder="Email" />
        <input id="password" type="password" placeholder="Password" />

        <div class="forgot">
            <a href="#" onclick="resetPassword()">Forgot your password?</a>
        </div>

        <button class="btn btn-login" onclick="login()">Login</button>
        <button class="btn btn-signup" onclick="signup()">Create Account</button>

        <button class="btn google-btn" onclick="googleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" />
            Sign in with Google
        </button>

        <div class="terms">
            By logging in, you accept the <a href="terms.html" target="_blank">Terms & Conditions</a>.
        </div>
    </div>
</body>
</html>
